<script>
  $(document).ready(function() {
    $('#backToModel').click(function() {
      window.location.href = '/rails_admin/' + '<%= @model %>' + '/' + '<%= @id %>';
    })
  })
</script>
<style>
  th {
    width: 10px;
  }
</style>


<div style="overflow: auto;">
  <h1>Vertica History for <%= @model %> <%= @id %> - Total: <%= @total_records %> records found</h1>

  <FORM style="padding-bottom: 20px">
    <INPUT Type="button" VALUE="Back to Model View" id='backToModel'></FORM>

  <div>Select New Attributes you want to see in the table for the history of the records in vertica</div>
  <%= form_for(@model.to_s.to_sym, url: { :controller => 'admin/vertica_history', :action => 'view_history' }, method: 'get', html: { class: 'form-horizontal' }) do |f| %>

    <% @all_columns.each do |key| %>
      <div id=<%= key %>>
        <li style="list-style-type: none;">
          <%= check_box_tag 'attribute-keys[]', key -%>
          <%= h key -%>
        </li>
      </div>
    <% end %>
    <li style="list-style-type: none;">
      <%= check_box_tag 'attribute-keys[]', "*" -%>
      <%= h "All Attributes" -%>
    </li>
    <%= f.submit('Change Attributes', class: 'btn btn-primary') %>
  <% end %>
  <p></p>

  <%= form_for(@model.to_s.to_sym, url: { :controller => 'admin/vertica_history', :action => 'view_history' }, method: 'get', html: { class: 'form-horizontal' }) do |f| %>

    <h3>Filters</h3>
    <%= text_field_tag :filter_column, nil, placeholder: 'Enter filter value...' %>
    <%= select_tag :filter_field, options_for_select(@columns), :include_blank => true%>

    <%= f.submit('Update/Filter Query', class: 'btn btn-primary') %>
  <% end %>

  <% if @query_hash.present? %>
    <h3>Current Filters:</h3>
    <% @query_hash.each do |col, val| %>
      <p><%= col %> = <%= val %></p>
    <% end %>

    <%= form_for(@model.to_s.to_sym, url: { :controller => 'admin/vertica_history', :action => 'view_history' }, method: 'get', html: { class: 'form-horizontal' }) do |f| %>
      <%= f.submit('Clear Filters', class: 'btn btn-primary') %>
    <% end %>
  <% end %>


</div>
<div>
  <p></p>
</div>

<div id="paginate">
  <table class="table table-striped table-bordered table-condensed text-center">
    <tr>
      <% @columns.each do |col| %>
        <th> <%= col.camelize %> <%= link_to '&#8657'.html_safe, admin_vertica_history_view_history_path(order_by: (col + ' asc'), columns: @columns) %>
          <%= link_to '&#8659'.html_safe, admin_vertica_history_view_history_path(order_by: (col + ' desc'), columns: @columns) %></th>
      <% end %>
    </tr>
    <% @history.each do |data| %>
      <tr style="word-wrap: break-word;">
        <% @columns.each do |col| %>
          <td>
            <%= data[col.to_sym] %>
          </td>
        <% end %>
      </tr>
    <% end %>
    <%= paginate @history %>
  </table>
</div>
</div>